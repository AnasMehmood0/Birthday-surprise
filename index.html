<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>A Super Animated Birthday Surprise!</title>
    
    <!-- Load Tailwind CSS for utility classes (layout, fonts, colors) --><script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Pacifico (festive) and Poppins (clean) --><link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&family=Poppins:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- General Styles & Fonts --- */
        body {
            font-family: 'Poppins', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        .font-pacifico {
            font-family: 'Pacifico', cursive;
        }

        /* --- Page 1: Surprise Page --- */

        #page-1 {
            /* More vibrant animated gradient background */
            background: linear-gradient(-45deg, #FF6B6B, #F0E68C, #8CFF6B, #6BC0FF, #D080FF);
            background-size: 400% 400%;
            animation: gradient-flow 20s ease infinite;
            transition: opacity 0.7s ease-out; /* For fade-out transition */
        }

        /* Keyframes for the background gradient flow */
        @keyframes gradient-flow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Keyframes for the pulsing surprise button */
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
            }
            50% {
                transform: scale(1.05);
                box-shadow: 0 0 0 20px rgba(255, 255, 255, 0); /* Larger pulse */
            }
        }
        
        .button-pulse {
            animation: pulse 2s infinite;
        }

        /* Hover animation for the surprise button */
        .surprise-button:hover {
            animation: button-pop 0.3s ease-out forwards;
        }

        @keyframes button-pop {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1.05); }
        }

        /* --- Page 2: Card Page --- */
        
        #page-2 {
            /* Dynamic animated gradient for page 2 background */
            background: linear-gradient(-45deg, #4A00E0, #8E2DE2, #F8B400, #F47B20);
            background-size: 400% 400%;
            animation: gradient-flow-card 25s ease infinite;
            transition: opacity 0.7s ease-in; /* For fade-in transition */
            opacity: 0; 
            /* REMOVED: position: relative; as background elements will be fixed */
        }

        @keyframes gradient-flow-card {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Animation for the card itself appearing */
        @keyframes card-reveal {
            from {
                opacity: 0;
                transform: scale(0.7) translateY(50px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .card-animate {
            animation: card-reveal 1.8s cubic-bezier(0.25, 0.8, 0.25, 1) forwards;
            position: relative; 
            z-index: 30; /* Ensure card is above balloons/poppers */
        }

        /* Animation for the text fading in (staggered) */
        @keyframes text-fade-in {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Animation for the bounce effect after text reveal */
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-15px); }
            60% { transform: translateY(-7px); }
        }

        /* Apply text animations with delays */
        .text-animate-1 {
            opacity: 0; /* Start hidden */
            animation: text-fade-in 1s ease-out 1.2s forwards, bounce 1s ease-out 2.2s; /* Added bounce */
        }
        .text-animate-2 {
            opacity: 0; /* Start hidden */
            animation: text-fade-in 1s ease-out 1.6s forwards;
        }
        .text-animate-3 {
            opacity: 0; /* Start hidden */
            animation: text-fade-in 1s ease-out 2.0s forwards;
        }

        /* Subtle sparkle effect for the card background */
        .sparkle-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: -1; /* Behind card content */
        }

        .sparkle {
            position: absolute;
            background: radial-gradient(white, yellow, transparent 70%);
            border-radius: 50%;
            opacity: 0;
            animation: twinkle 5s infinite;
        }

        @keyframes twinkle {
            0% { transform: scale(0) rotate(0deg); opacity: 0; }
            50% { transform: scale(0.8) rotate(180deg); opacity: 0.7; }
            100% { transform: scale(0) rotate(360deg); opacity: 0; }
        }


        /* --- Balloon Animations (FIXED TO VIEWPORT) --- */
        .balloon-container {
            /* FIX: Use fixed position and vh/vw units to ensure animations are tied to the viewport, not the scrollable content */
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            z-index: 10;
        }
        
        /* --- Party Popper Animations (FIXED TO VIEWPORT) --- */
        .popper-container {
            /* FIX: Use fixed position and vh/vw units */
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100vw;
            height: 100vh; /* Set height to 100vh so confetti animation can span the screen */
            overflow: hidden;
            pointer-events: none;
            z-index: 20; /* Above balloons, below card */
        }


        .balloon {
            position: absolute;
            bottom: -150px; /* Start below the screen */
            width: 70px; /* Slightly larger balloons */
            height: 85px;
            border-radius: 100% 100% 100% 100% / 100% 100% 130% 130%; /* Balloon shape */
            opacity: 0.9; /* Slightly more opaque */
            animation-name: float-and-sway;
            animation-timing-function: ease-in-out; /* Smoother movement */
            animation-iteration-count: infinite;
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.3)); /* Add shadow */
        }

        /* Balloon string */
        .balloon::after {
            content: '';
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 2px; /* Thicker string */
            height: 50px; /* Longer string */
            background: rgba(255, 255, 255, 0.7);
        }

        /* Keyframes for the floating and swaying motion */
        @keyframes float-and-sway {
            0% { transform: translateY(0) translateX(0) rotate(0deg); opacity: 1; }
            25% { transform: translateY(-25vh) translateX(40px) rotate(-15deg); }
            50% { transform: translateY(-50vh) translateX(-35px) rotate(12deg); }
            75% { transform: translateY(-75vh) translateX(30px) rotate(-15deg); }
            100% { transform: translateY(-110vh) translateX(-30px) rotate(12deg); opacity: 0; }
        }

        /* Define different colors, speeds, and delays for each balloon */
        .balloon:nth-child(1) {
            left: 5%;
            background: #FF6F91; /* Bright Pink */
            animation-duration: 14s;
            animation-delay: 0s;
        }
        .balloon:nth-child(2) {
            left: 18%;
            background: #FFC72C; /* Sunny Yellow */
            animation-duration: 17s;
            animation-delay: 2s;
        }
        .balloon:nth-child(3) {
            left: 30%;
            background: #1CD6CE; /* Aqua Blue */
            animation-duration: 11s;
            animation-delay: 1s;
        }
        .balloon:nth-child(4) {
            left: 45%;
            background: #9D00FF; /* Electric Purple */
            animation-duration: 15s;
            animation-delay: 4s;
        }
        .balloon:nth-child(5) {
            left: 60%;
            background: #00FF87; /* Vivid Green */
            animation-duration: 13s;
            animation-delay: 2.5s;
        }
        .balloon:nth-child(6) {
            left: 75%;
            background: #FF7B00; /* Bright Orange */
            animation-duration: 16s;
            animation-delay: 5s;
        }
        .balloon:nth-child(7) {
            left: 90%;
            background: #FF006E; /* Raspberry */
            animation-duration: 12s;
            animation-delay: 3s;
        }

        /* --- Party Popper Animations --- */
        .popper {
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-radius: 50%;
            background: transparent;
            animation: launch-popper 3s ease-out forwards;
            opacity: 0;
        }

        /* Confetti pieces */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: var(--confetti-color);
            border-radius: 2px;
            animation: confetti-fall var(--duration) linear forwards;
            opacity: 0;
        }

        /* Keyframes for popper launch (simulates a burst) */
        @keyframes launch-popper {
            0% { transform: translateX(-50%) scale(0); opacity: 0; }
            10% { transform: translateX(-50%) scale(1); opacity: 1; }
            100% { transform: translateX(-50%) scale(0); opacity: 0; }
        }

        /* Keyframes for individual confetti fall */
        @keyframes confetti-fall {
            0% { transform: translate(0, 0) rotateZ(0deg); opacity: 1; }
            100% { transform: translate(var(--x), var(--y)) rotateZ(var(--rot)) opacity: 0; }
        }


        /* --- Page Transition Classes --- */
        .hidden {
            display: none;
        }

        .page-fade-out {
            opacity: 0;
        }

        /* Simple CSS loader for Gemini API call */
        .loader {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #fff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
    </style>
</head>
<body class="bg-gray-100">

    <!-- Page 1: Surprise Page (Visible by default) -->
    <div id="page-1" class="min-h-screen w-full flex items-center justify-center p-6">
        <div class="text-center bg-white/30 backdrop-blur-md p-10 md:p-16 rounded-2xl shadow-2xl">
            <h1 class="font-pacifico text-4xl md:text-6xl text-white text-shadow mb-8">
                A Special Surprise...
            </h1>
            <p class="text-lg md:text-xl text-white/90 mb-10">
                Anas sent a message for you!
            </p>
            <button id="surprise-button" class="surprise-button button-pulse text-lg md:text-xl font-bold text-gray-800 bg-white py-4 px-10 rounded-full shadow-xl transition-transform transform hover:scale-105">
                Click for your surprise!
            </button>
        </div>
    </div>

    <!-- Page 2: Card Page (Hidden by default) -->
    <!-- FIX: Replaced 'items-center justify-center' with 'flex-col items-center' to allow vertical scrolling -->
    <div id="page-2" class="hidden min-h-screen w-full flex flex-col items-center p-6 py-10">
        
        <!-- Balloon Container (FIXED position applied in CSS) --><div class="balloon-container">
            <div class="balloon"></div>
            <div class="balloon"></div>
            <div class="balloon"></div>
            <div class="balloon"></div>
            <div class="balloon"></div>
            <div class="balloon"></div>
            <div class="balloon"></div>
        </div>

        <!-- Party Popper Container (FIXED position applied in CSS) --><div class="popper-container" id="popper-container"></div>


        <!-- The Card Content --><div class="card-animate text-center bg-black/40 backdrop-blur-md p-10 md:p-16 rounded-2xl shadow-2xl max-w-2xl z-30">
            <!-- Sparkle background for the card --><div class="sparkle-background"></div>

            <h1 class="text-animate-1 font-pacifico text-6xl md:text-8xl text-transparent bg-clip-text bg-gradient-to-r from-yellow-200 via-pink-300 to-red-400 mb-6">
                Happy Birthday Ali ðŸ«‚ !
            </h1>
            <p class="text-animate-2 text-lg md:text-2xl text-gray-100/90 leading-relaxed">
                Wishing you the most amazing day, filled with joy, laughter, and everything you wished for. You deserve all the happiness in the world!
            </p>

            <!-- --- âœ¨ Gemini API Feature Start --- --><div id="gemini-feature" class="text-animate-3 mt-8">
                <!-- 1. Initial Button --><button id="personalize-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full transition-all duration-300 transform hover:scale-105">
                    âœ¨ Personalize This Wish
                </button>

                <!-- 2. Form (hidden by default) --><div id="personalize-form" class="hidden mt-6 text-left">
                    <label for="prompt-input" class="block text-lg font-medium text-gray-200 mb-2">What's one thing you're excited for this year?</label>
                    <input type="text" id="prompt-input" class="w-full p-3 rounded-lg bg-white/20 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-400" placeholder="e.g., learning guitar, traveling, a new project...">
                    <button id="generate-button" class="w-full mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-6 rounded-full transition-all duration-300 transform hover:scale-105">
                        Get My Wish!
                    </button>
                </div>

                <!-- 3. Result/Loading Area --><div id="gemini-result-container" class="mt-6">
                    <!-- Loader will be injected here --></div>
                <div id="gemini-result-text" class="mt-6 p-4 bg-black/40 rounded-lg text-lg text-gray-200 leading-relaxed" style="display: none;">
                    <!-- Generated text will go here --></div>
                <div id="gemini-error" class="mt-4 text-red-400 font-medium"></div>

            </div>
            <!-- --- âœ¨ Gemini API Feature End --- --></div>

    </div>

    <script>
        // --- âœ¨ Gemini API Configuration ---
        const API_KEY = ""; // Keep this empty as instructed
        const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${API_KEY}`;
        const SYSTEM_PROMPT = "You are a fun, cheerful, and encouraging birthday bot. You write short, sweet, and inspiring birthday messages (2-3 sentences max).";

        /**
         * Fetches data from the Gemini API with exponential backoff.
         */
        async function fetchWithRetry(url, options, retries = 3, delay = 1000) {
            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(url, options);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return await response.json();
                } catch (error) {
                    console.warn(`Attempt ${i + 1} failed. Retrying in ${delay}ms...`, error);
                    if (i < retries - 1) {
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2; // Exponential backoff
                    } else {
                        throw error; // Last attempt failed
                    }
                }
            }
        }

        /**
         * Calls the Gemini API to generate a personalized birthday wish.
         */
        async function generateWish(topic) {
            const resultContainer = document.getElementById('gemini-result-container');
            const resultTextEl = document.getElementById('gemini-result-text');
            const errorEl = document.getElementById('gemini-error');
            
            // Clear previous results/errors and show loader
            resultTextEl.textContent = '';
            resultTextEl.style.display = 'none';
            errorEl.textContent = '';
            resultContainer.innerHTML = '<div class="loader"></div>'; // Show loader

            const userQuery = `Write a short, uplifting birthday wish for someone who is excited about "${topic}" this year.`;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: {
                    parts: [{ text: SYSTEM_PROMPT }]
                },
            };

            try {
                const result = await fetchWithRetry(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const candidate = result.candidates?.[0];
                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const generatedText = candidate.content.parts[0].text;
                    resultTextEl.textContent = generatedText;
                    resultTextEl.style.display = 'block'; // Show result
                } else {
                    throw new Error("Invalid response from API. No text generated.");
                }

            } catch (error) {
                console.error("Error calling Gemini API:", error);
                errorEl.textContent = "Oops! Couldn't generate a wish right now. Please try again later.";
            } finally {
                resultContainer.innerHTML = ''; // Hide loader
            }
        }

        // --- Sparkle Generator for Card Background ---
        function createSparkle() {
            const sparkleDiv = document.createElement('div');
            sparkleDiv.classList.add('sparkle');
            const size = Math.random() * 8 + 4; // Sparkle size 4-12px
            sparkleDiv.style.width = `${size}px`;
            sparkleDiv.style.height = `${size}px`;
            sparkleDiv.style.left = `${Math.random() * 100}%`;
            sparkleDiv.style.top = `${Math.random() * 100}%`;
            sparkleDiv.style.animationDelay = `${Math.random() * 5}s`;
            document.querySelector('#page-2 .sparkle-background').appendChild(sparkleDiv);
        }

        // --- Party Popper Logic ---
        const confettiColors = ['#FF6B6B', '#F0E68C', '#8CFF6B', '#6BC0FF', '#D080FF', '#FF006E'];

        function createConfetti(popperX, popperY) {
            const popperContainer = document.getElementById('popper-container');
            for (let i = 0; i < 30; i++) { // Number of confetti pieces
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.setProperty('--confetti-color', confettiColors[Math.floor(Math.random() * confettiColors.length)]);
                confetti.style.setProperty('--x', `${(Math.random() - 0.5) * 400}px`); /* Spread horizontally */
                confetti.style.setProperty('--y', `${-(Math.random() * 300 + 100)}px`); /* Shoot upwards */
                confetti.style.setProperty('--rot', `${Math.random() * 720}deg`); /* Random rotation */
                confetti.style.setProperty('--duration', `${Math.random() * 2 + 1.5}s`); /* Random duration */
                
                // Start confetti from the popper's position
                confetti.style.left = `${popperX}px`;
                confetti.style.top = `${popperY}px`;
                confetti.style.opacity = 1; // Make visible
                
                popperContainer.appendChild(confetti);

                // Remove confetti after animation to prevent DOM clutter
                confetti.addEventListener('animationend', () => {
                    confetti.remove();
                });
            }
        }

        function launchPopper(delay) {
            setTimeout(() => {
                const popperContainer = document.getElementById('popper-container');
                const popper = document.createElement('div');
                popper.classList.add('popper');
                
                // Randomize popper position slightly
                const randomX = Math.random() * 80 + 10; // 10% to 90% width
                popper.style.left = `${randomX}%`;
                popper.style.animationDelay = `${Math.random() * 0.5}s`; // Stagger confetti burst
                popperContainer.appendChild(popper);

                popper.addEventListener('animationend', () => {
                    // Get the final position of the popper for confetti origin
                    const rect = popper.getBoundingClientRect();
                    createConfetti(rect.left + rect.width / 2, rect.top + rect.height / 2);
                    popper.remove();
                }, { once: true });
            }, delay);
        }

        function fireMultiplePoppers() {
            const numPoppers = 3; // Number of poppers to fire
            for (let i = 0; i < numPoppers; i++) {
                launchPopper(i * 700 + 500); // Fire with staggered delays
            }
        }


        // --- Original Page Transition Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            const page1 = document.getElementById('page-1');
            const page2 = document.getElementById('page-2');
            const surpriseButton = document.getElementById('surprise-button');

            // Generate sparkles on page 2 before it's shown, so they start animating immediately
            for (let i = 0; i < 50; i++) { // 50 sparkles
                createSparkle();
            }

            surpriseButton.addEventListener('click', () => {
                // 1. Add the fade-out class to page 1
                page1.classList.add('page-fade-out');

                // 2. Listen for the fade-out animation to end
                page1.addEventListener('transitionend', () => {
                    // 3. Hide page 1
                    page1.classList.add('hidden');
                    
                    // 4. Show page 2 (remove 'hidden')
                    // 'flex flex-col items-center' allows vertical expansion and scrolling
                    page2.classList.remove('hidden');
                    page2.style.display = 'flex';
                    
                    // 5. Trigger the fade-in for page 2 (slight delay for smoothness)
                    // We force a reflow for the transition to apply correctly
                    void page2.offsetWidth; // Force reflow
                    page2.style.opacity = 1;

                    // Fire poppers once page 2 is visible
                    fireMultiplePoppers();

                }, { once: true }); // The event listener only runs once
            });

            // --- âœ¨ New Event Listeners for Gemini Feature ---
            const personalizeButton = document.getElementById('personalize-button');
            const personalizeForm = document.getElementById('personalize-form');
            const generateButton = document.getElementById('generate-button');
            const promptInput = document.getElementById('prompt-input');

            // 1. Show the form when "Personalize" is clicked
            personalizeButton.addEventListener('click', () => {
                personalizeButton.style.display = 'none';
                personalizeForm.classList.remove('hidden');
                promptInput.focus();
            });

            // 2. Call the API when "Get My Wish" is clicked
            generateButton.addEventListener('click', () => {
                const topic = promptInput.value.trim();
                if (topic) {
                    personalizeForm.style.display = 'none'; // Hide form
                    generateWish(topic);
                } else {
                    const errorEl = document.getElementById('gemini-error');
                    errorEl.textContent = "Please enter something you're excited about!";
                }
            });
        });
    </script>

</body>
</html>
